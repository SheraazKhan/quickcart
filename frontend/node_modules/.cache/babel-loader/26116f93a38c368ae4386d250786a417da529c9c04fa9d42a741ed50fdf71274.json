{"ast":null,"code":"var _jsxFileName = \"D:\\\\Quickcart\\\\frontend\\\\src\\\\pages\\\\Products.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport axios from \"axios\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport API_BASE_URL from \"../utils/api\";\nimport FiltersSidebar from \"../components/FiltersSidebar\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Products = () => {\n  _s();\n  const navigate = useNavigate();\n  const {\n    search\n  } = useLocation();\n\n  // URL params: ?search=...&category=...\n  const params = new URLSearchParams(search);\n  const query = (params.get(\"search\") || \"\").trim().toLowerCase();\n  const categoryParam = (params.get(\"category\") || \"\").trim().toLowerCase();\n  const [loading, setLoading] = useState(true);\n  const [products, setProducts] = useState([]);\n  const [favorites, setFavorites] = useState([]); // array of product _ids\n  const [sort, setSort] = useState(\"popular\");\n  const [inStockOnly, setInStockOnly] = useState(false);\n  const [selectedBrands, setSelectedBrands] = useState([]);\n  const [priceRange, setPriceRange] = useState({\n    min: 0,\n    max: 0\n  });\n  const user = (() => {\n    try {\n      return JSON.parse(localStorage.getItem(\"user\"));\n    } catch {\n      return null;\n    }\n  })();\n  const token = localStorage.getItem(\"token\");\n  useEffect(() => {\n    let mounted = true;\n    setLoading(true);\n    const fetchAll = async () => {\n      try {\n        var _favRes$data;\n        const [prodRes, favRes] = await Promise.all([axios.get(`${API_BASE_URL}/api/products`), user ? axios.get(`${API_BASE_URL}/api/users/${user.id}/favorites`, {\n          headers: token ? {\n            Authorization: `Bearer ${token}`\n          } : {}\n        }) : Promise.resolve({\n          data: {\n            favorites: []\n          }\n        })]);\n        if (!mounted) return;\n        setProducts(Array.isArray(prodRes.data) ? prodRes.data : []);\n        // normalize favorites to array of ids\n        const favs = (((_favRes$data = favRes.data) === null || _favRes$data === void 0 ? void 0 : _favRes$data.favorites) || []).map(f => typeof f === \"string\" ? f : f === null || f === void 0 ? void 0 : f._id);\n        setFavorites(favs);\n      } catch (err) {\n        console.error(\"Error fetching products/favorites:\", err);\n        setProducts([]);\n        setFavorites([]);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n    fetchAll();\n    return () => {\n      mounted = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [API_BASE_URL, user === null || user === void 0 ? void 0 : user.id, token]);\n  const handleDelete = async id => {\n    if (!window.confirm(\"Delete this product?\")) return;\n    try {\n      await axios.delete(`${API_BASE_URL}/api/products/${id}`, {\n        headers: token ? {\n          Authorization: `Bearer ${token}`\n        } : {}\n      });\n      setProducts(prev => prev.filter(p => p._id !== id));\n    } catch (err) {\n      console.error(\"Delete error:\", err);\n      alert(\"Failed to delete product\");\n    }\n  };\n  const toggleFavorite = async productId => {\n    if (!user) {\n      navigate(\"/login\");\n      return;\n    }\n    try {\n      var _res$data, _res$data$favorites;\n      // optimistic update\n      setFavorites(prev => prev.includes(productId) ? prev.filter(id => id !== productId) : [...prev, productId]);\n      const res = await axios.post(`${API_BASE_URL}/api/users/${user.id}/favorites`, {\n        productId\n      }, {\n        headers: token ? {\n          Authorization: `Bearer ${token}`\n        } : {}\n      });\n      const normalized = ((_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$favorites = _res$data.favorites) === null || _res$data$favorites === void 0 ? void 0 : _res$data$favorites.map(f => typeof f === \"string\" ? f : f === null || f === void 0 ? void 0 : f._id)) || [];\n      setFavorites(normalized);\n      localStorage.setItem(\"user\", JSON.stringify({\n        ...user,\n        favorites: normalized\n      }));\n    } catch (err) {\n      console.error(\"Favorite toggle failed\", err);\n      // revert optimistic on error\n      setFavorites(prev => prev.includes(productId) ? prev.filter(id => id !== productId) : [...prev, productId]);\n    }\n  };\n  const addToCart = product => {\n    const cart = JSON.parse(localStorage.getItem(\"cart\") || \"[]\");\n    const idx = cart.findIndex(i => i._id === product._id);\n    if (idx >= 0) cart[idx].quantity += 1;else cart.push({\n      ...product,\n      quantity: 1\n    });\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    alert(`${product.name} added to cart`);\n  };\n  const getProductImage = img => {\n    if (!img) return \"/placeholder.jpg\";\n    // Support: string path (\"/images/x.jpg\"), object {url}, or full URL\n    if (typeof img === \"string\") {\n      if (/^https?:\\/\\//i.test(img)) return img;\n      return `${API_BASE_URL}${img.startsWith(\"/\") ? \"\" : \"/\"}${img}`;\n    }\n    if (img !== null && img !== void 0 && img.url) return img.url;\n    return \"/placeholder.jpg\";\n  };\n\n  // Build brand list\n  const allBrands = useMemo(() => Array.from(new Set(products.map(p => (p.brand || p.manufacturer || \"\").toString().trim()).filter(Boolean))).sort(), [products]);\n\n  // Filter & sort\n  const filtered = useMemo(() => {\n    let list = [...products];\n    if (categoryParam) {\n      list = list.filter(p => (p.category || \"\").toLowerCase().includes(categoryParam));\n    }\n    if (query) {\n      const q = query.toLowerCase();\n      list = list.filter(p => {\n        const fields = [p.name, p.description, p.category, p.brand, p.manufacturer].filter(Boolean).join(\" \").toLowerCase();\n        return fields.includes(q);\n      });\n    }\n    if (inStockOnly) list = list.filter(p => {\n      var _p$countInStock;\n      return ((_p$countInStock = p.countInStock) !== null && _p$countInStock !== void 0 ? _p$countInStock : 0) > 0;\n    });\n    if (selectedBrands.length) {\n      list = list.filter(p => selectedBrands.includes(p.brand || p.manufacturer));\n    }\n    // Price range\n    if (priceRange.min > 0 || priceRange.max > 0) {\n      const min = Number(priceRange.min) || 0;\n      const max = Number(priceRange.max) || Number.POSITIVE_INFINITY;\n      list = list.filter(p => {\n        const price = Number(p.price || 0);\n        return price >= min && price <= max;\n      });\n    }\n    if (sort === \"price-asc\") list.sort((a, b) => (a.price || 0) - (b.price || 0));\n    if (sort === \"price-desc\") list.sort((a, b) => (b.price || 0) - (a.price || 0));\n    // \"popular\" => leave original order\n\n    return list;\n  }, [products, query, categoryParam, inStockOnly, selectedBrands, sort, priceRange.min, priceRange.max]);\n  const isFavorite = id => favorites.includes(id);\n\n  // UI helpers\n  const Heart = ({\n    filled\n  }) => /*#__PURE__*/_jsxDEV(\"svg\", {\n    viewBox: \"0 0 24 24\",\n    className: `h-6 w-6 ${filled ? \"fill-red-500\" : \"fill-none\"} stroke-red-500`,\n    strokeWidth: \"2\",\n    children: /*#__PURE__*/_jsxDEV(\"path\", {\n      d: \"M12 21s-7.364-4.455-9.428-8.571C.13 9.23 1.63 6 4.714 6c1.9 0 3.238 1.143 4.286 2.571C10.048 7.143 11.386 6 13.286 6 16.37 6 17.87 9.23 21.428 12.429 19.364 16.545 12 21 12 21z\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    className: \"bg-gray-50 min-h-screen\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-[260px_1fr] gap-6\",\n      children: [/*#__PURE__*/_jsxDEV(FiltersSidebar, {\n        brands: allBrands,\n        selectedBrands: selectedBrands,\n        setSelectedBrands: setSelectedBrands,\n        inStockOnly: inStockOnly,\n        setInStockOnly: setInStockOnly,\n        sort: sort,\n        setSort: setSort,\n        priceRange: priceRange,\n        setPriceRange: setPriceRange,\n        onClear: () => {\n          setSelectedBrands([]);\n          setInStockOnly(false);\n          setSort(\"popular\");\n          setPriceRange({\n            min: 0,\n            max: 0\n          });\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-600\",\n            children: [\"Showing \", filtered.length, \" product\", filtered.length !== 1 ? \"s\" : \"\", query && /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\" \", \"for \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"font-semibold\",\n                children: [\"\\u201C\", query, \"\\u201D\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 254,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 17\n            }, this), categoryParam && /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\" \", \"in \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"font-semibold\",\n                children: categoryParam\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 260,\n                columnNumber: 22\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"text-sm text-indigo-600 hover:underline\",\n            onClick: () => navigate(\"/products\"),\n            children: \"Clear filters\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 11\n        }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4\",\n          children: Array.from({\n            length: 8\n          }).map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded-xl shadow-[0_1px_2px_rgba(0,0,0,0.06),0_10px_20px_rgba(0,0,0,0.06)] ring-1 ring-black/5 p-4 animate-pulse\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"h-40 bg-gray-200 rounded mb-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"h-4 bg-gray-200 rounded w-3/4 mb-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 281,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"h-4 bg-gray-200 rounded w-1/3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 19\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 13\n        }, this) : filtered.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white rounded-xl p-10 text-center text-gray-600 ring-1 ring-black/5\",\n          children: \"No products found.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4\",\n          children: filtered.map(product => {\n            var _product$countInStock;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative bg-white rounded-xl shadow-[0_1px_2px_rgba(0,0,0,0.06),0_10px_20px_rgba(0,0,0,0.06)] ring-1 ring-black/5 overflow-hidden\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => toggleFavorite(product._id),\n                title: isFavorite(product._id) ? \"Remove from favorites\" : \"Add to favorites\",\n                className: \"absolute top-3 right-3 rounded-full bg-white/90 p-1.5 shadow ring-1 ring-black/5\",\n                children: /*#__PURE__*/_jsxDEV(Heart, {\n                  filled: isFavorite(product._id)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 307,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 298,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-3\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: getProductImage(product.image),\n                  alt: product.name,\n                  className: \"w-full h-44 object-contain bg-white rounded-lg\",\n                  onError: e => e.currentTarget.src = \"/placeholder.jpg\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 312,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 311,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"px-4 pb-4\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-xs text-gray-500\",\n                  children: ((_product$countInStock = product.countInStock) !== null && _product$countInStock !== void 0 ? _product$countInStock : 0) > 0 ? \"In stock\" : \"Out of stock\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 322,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"font-semibold mt-1 line-clamp-1\",\n                  children: product.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 325,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm text-gray-600 line-clamp-2\",\n                  children: product.description\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"mt-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex items-center justify-between\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"text-lg font-bold\",\n                      children: [\"$\", Number(product.price || 0).toFixed(2)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 333,\n                      columnNumber: 25\n                    }, this), token && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex items-center gap-1\",\n                      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => navigate(`/edit-product/${product._id}`),\n                        title: \"Edit\",\n                        className: \"p-2 rounded-md bg-yellow-500/90 hover:bg-yellow-600 text-white ring-1 ring-black/5\",\n                        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                          viewBox: \"0 0 24 24\",\n                          className: \"h-4 w-4\",\n                          fill: \"currentColor\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 346,\n                            columnNumber: 33\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 345,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 340,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => handleDelete(product._id),\n                        title: \"Delete\",\n                        className: \"p-2 rounded-md bg-red-500/90 hover:bg-red-600 text-white ring-1 ring-black/5\",\n                        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                          viewBox: \"0 0 24 24\",\n                          className: \"h-4 w-4\",\n                          fill: \"currentColor\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 356,\n                            columnNumber: 33\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 355,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 350,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 338,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 332,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: () => addToCart(product),\n                    className: \"mt-3 w-full px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold\",\n                    children: \"Add to cart\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 363,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 331,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 19\n              }, this)]\n            }, product._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 225,\n    columnNumber: 5\n  }, this);\n};\n_s(Products, \"hmVCtKbC0YQvzHOtATEuhVrnPuI=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Products;\nexport default Products;\nvar _c;\n$RefreshReg$(_c, \"Products\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","axios","useLocation","useNavigate","API_BASE_URL","FiltersSidebar","jsxDEV","_jsxDEV","Products","_s","navigate","search","params","URLSearchParams","query","get","trim","toLowerCase","categoryParam","loading","setLoading","products","setProducts","favorites","setFavorites","sort","setSort","inStockOnly","setInStockOnly","selectedBrands","setSelectedBrands","priceRange","setPriceRange","min","max","user","JSON","parse","localStorage","getItem","token","mounted","fetchAll","_favRes$data","prodRes","favRes","Promise","all","id","headers","Authorization","resolve","data","Array","isArray","favs","map","f","_id","err","console","error","handleDelete","window","confirm","delete","prev","filter","p","alert","toggleFavorite","productId","_res$data","_res$data$favorites","includes","res","post","normalized","setItem","stringify","addToCart","product","cart","idx","findIndex","i","quantity","push","name","getProductImage","img","test","startsWith","url","allBrands","from","Set","brand","manufacturer","toString","Boolean","filtered","list","category","q","fields","description","join","_p$countInStock","countInStock","length","Number","POSITIVE_INFINITY","price","a","b","isFavorite","Heart","filled","viewBox","className","strokeWidth","children","d","fileName","_jsxFileName","lineNumber","columnNumber","brands","onClear","onClick","_","_product$countInStock","title","src","image","alt","onError","e","currentTarget","toFixed","fill","_c","$RefreshReg$"],"sources":["D:/Quickcart/frontend/src/pages/Products.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport API_BASE_URL from \"../utils/api\";\r\nimport FiltersSidebar from \"../components/FiltersSidebar\";\r\n\r\nconst Products = () => {\r\n  const navigate = useNavigate();\r\n  const { search } = useLocation();\r\n\r\n  // URL params: ?search=...&category=...\r\n  const params = new URLSearchParams(search);\r\n  const query = (params.get(\"search\") || \"\").trim().toLowerCase();\r\n  const categoryParam = (params.get(\"category\") || \"\").trim().toLowerCase();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [products, setProducts] = useState([]);\r\n  const [favorites, setFavorites] = useState([]); // array of product _ids\r\n  const [sort, setSort] = useState(\"popular\");\r\n  const [inStockOnly, setInStockOnly] = useState(false);\r\n  const [selectedBrands, setSelectedBrands] = useState([]);\r\n  const [priceRange, setPriceRange] = useState({ min: 0, max: 0 });\r\n\r\n  const user = (() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem(\"user\"));\r\n    } catch {\r\n      return null;\r\n    }\r\n  })();\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setLoading(true);\r\n\r\n    const fetchAll = async () => {\r\n      try {\r\n        const [prodRes, favRes] = await Promise.all([\r\n          axios.get(`${API_BASE_URL}/api/products`),\r\n          user\r\n            ? axios.get(`${API_BASE_URL}/api/users/${user.id}/favorites`, {\r\n                headers: token ? { Authorization: `Bearer ${token}` } : {},\r\n              })\r\n            : Promise.resolve({ data: { favorites: [] } }),\r\n        ]);\r\n\r\n        if (!mounted) return;\r\n\r\n        setProducts(Array.isArray(prodRes.data) ? prodRes.data : []);\r\n        // normalize favorites to array of ids\r\n        const favs = (favRes.data?.favorites || []).map((f) =>\r\n          typeof f === \"string\" ? f : f?._id\r\n        );\r\n        setFavorites(favs);\r\n      } catch (err) {\r\n        console.error(\"Error fetching products/favorites:\", err);\r\n        setProducts([]);\r\n        setFavorites([]);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchAll();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [API_BASE_URL, user?.id, token]);\r\n\r\n  const handleDelete = async (id) => {\r\n    if (!window.confirm(\"Delete this product?\")) return;\r\n    try {\r\n      await axios.delete(`${API_BASE_URL}/api/products/${id}`, {\r\n        headers: token ? { Authorization: `Bearer ${token}` } : {},\r\n      });\r\n      setProducts((prev) => prev.filter((p) => p._id !== id));\r\n    } catch (err) {\r\n      console.error(\"Delete error:\", err);\r\n      alert(\"Failed to delete product\");\r\n    }\r\n  };\r\n\r\n  const toggleFavorite = async (productId) => {\r\n    if (!user) {\r\n      navigate(\"/login\");\r\n      return;\r\n    }\r\n    try {\r\n      // optimistic update\r\n      setFavorites((prev) =>\r\n        prev.includes(productId)\r\n          ? prev.filter((id) => id !== productId)\r\n          : [...prev, productId]\r\n      );\r\n\r\n      const res = await axios.post(\r\n        `${API_BASE_URL}/api/users/${user.id}/favorites`,\r\n        { productId },\r\n        { headers: token ? { Authorization: `Bearer ${token}` } : {} }\r\n      );\r\n\r\n      const normalized =\r\n        res.data?.favorites?.map((f) => (typeof f === \"string\" ? f : f?._id)) ||\r\n        [];\r\n      setFavorites(normalized);\r\n      localStorage.setItem(\r\n        \"user\",\r\n        JSON.stringify({ ...user, favorites: normalized })\r\n      );\r\n    } catch (err) {\r\n      console.error(\"Favorite toggle failed\", err);\r\n      // revert optimistic on error\r\n      setFavorites((prev) =>\r\n        prev.includes(productId)\r\n          ? prev.filter((id) => id !== productId)\r\n          : [...prev, productId]\r\n      );\r\n    }\r\n  };\r\n\r\n  const addToCart = (product) => {\r\n    const cart = JSON.parse(localStorage.getItem(\"cart\") || \"[]\");\r\n    const idx = cart.findIndex((i) => i._id === product._id);\r\n    if (idx >= 0) cart[idx].quantity += 1;\r\n    else cart.push({ ...product, quantity: 1 });\r\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\r\n    alert(`${product.name} added to cart`);\r\n  };\r\n\r\n  const getProductImage = (img) => {\r\n    if (!img) return \"/placeholder.jpg\";\r\n    // Support: string path (\"/images/x.jpg\"), object {url}, or full URL\r\n    if (typeof img === \"string\") {\r\n      if (/^https?:\\/\\//i.test(img)) return img;\r\n      return `${API_BASE_URL}${img.startsWith(\"/\") ? \"\" : \"/\"}${img}`;\r\n    }\r\n    if (img?.url) return img.url;\r\n    return \"/placeholder.jpg\";\r\n  };\r\n\r\n  // Build brand list\r\n  const allBrands = useMemo(\r\n    () =>\r\n      Array.from(\r\n        new Set(\r\n          products\r\n            .map((p) => (p.brand || p.manufacturer || \"\").toString().trim())\r\n            .filter(Boolean)\r\n        )\r\n      ).sort(),\r\n    [products]\r\n  );\r\n\r\n  // Filter & sort\r\n  const filtered = useMemo(() => {\r\n    let list = [...products];\r\n\r\n    if (categoryParam) {\r\n      list = list.filter((p) =>\r\n        (p.category || \"\").toLowerCase().includes(categoryParam)\r\n      );\r\n    }\r\n    if (query) {\r\n      const q = query.toLowerCase();\r\n      list = list.filter((p) => {\r\n        const fields = [\r\n          p.name,\r\n          p.description,\r\n          p.category,\r\n          p.brand,\r\n          p.manufacturer,\r\n        ]\r\n          .filter(Boolean)\r\n          .join(\" \")\r\n          .toLowerCase();\r\n        return fields.includes(q);\r\n      });\r\n    }\r\n    if (inStockOnly) list = list.filter((p) => (p.countInStock ?? 0) > 0);\r\n    if (selectedBrands.length) {\r\n      list = list.filter((p) => selectedBrands.includes(p.brand || p.manufacturer));\r\n    }\r\n    // Price range\r\n    if (priceRange.min > 0 || priceRange.max > 0) {\r\n      const min = Number(priceRange.min) || 0;\r\n      const max = Number(priceRange.max) || Number.POSITIVE_INFINITY;\r\n      list = list.filter((p) => {\r\n        const price = Number(p.price || 0);\r\n        return price >= min && price <= max;\r\n      });\r\n    }\r\n\r\n    if (sort === \"price-asc\") list.sort((a, b) => (a.price || 0) - (b.price || 0));\r\n    if (sort === \"price-desc\") list.sort((a, b) => (b.price || 0) - (a.price || 0));\r\n    // \"popular\" => leave original order\r\n\r\n    return list;\r\n  }, [\r\n    products,\r\n    query,\r\n    categoryParam,\r\n    inStockOnly,\r\n    selectedBrands,\r\n    sort,\r\n    priceRange.min,\r\n    priceRange.max,\r\n  ]);\r\n\r\n  const isFavorite = (id) => favorites.includes(id);\r\n\r\n  // UI helpers\r\n  const Heart = ({ filled }) => (\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      className={`h-6 w-6 ${filled ? \"fill-red-500\" : \"fill-none\"} stroke-red-500`}\r\n      strokeWidth=\"2\"\r\n    >\r\n      <path d=\"M12 21s-7.364-4.455-9.428-8.571C.13 9.23 1.63 6 4.714 6c1.9 0 3.238 1.143 4.286 2.571C10.048 7.143 11.386 6 13.286 6 16.37 6 17.87 9.23 21.428 12.429 19.364 16.545 12 21 12 21z\" />\r\n    </svg>\r\n  );\r\n\r\n  return (\r\n    <main className=\"bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-[260px_1fr] gap-6\">\r\n        {/* Sidebar */}\r\n        <FiltersSidebar\r\n          brands={allBrands}\r\n          selectedBrands={selectedBrands}\r\n          setSelectedBrands={setSelectedBrands}\r\n          inStockOnly={inStockOnly}\r\n          setInStockOnly={setInStockOnly}\r\n          sort={sort}\r\n          setSort={setSort}\r\n          priceRange={priceRange}\r\n          setPriceRange={setPriceRange}\r\n          onClear={() => {\r\n            setSelectedBrands([]);\r\n            setInStockOnly(false);\r\n            setSort(\"popular\");\r\n            setPriceRange({ min: 0, max: 0 });\r\n          }}\r\n        />\r\n\r\n        {/* Content */}\r\n        <section>\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div className=\"text-sm text-gray-600\">\r\n              Showing {filtered.length} product{filtered.length !== 1 ? \"s\" : \"\"}\r\n              {query && (\r\n                <span>\r\n                  {\" \"}\r\n                  for <span className=\"font-semibold\">“{query}”</span>\r\n                </span>\r\n              )}\r\n              {categoryParam && (\r\n                <span>\r\n                  {\" \"}\r\n                  in <span className=\"font-semibold\">{categoryParam}</span>\r\n                </span>\r\n              )}\r\n            </div>\r\n            <button\r\n              className=\"text-sm text-indigo-600 hover:underline\"\r\n              onClick={() => navigate(\"/products\")}\r\n            >\r\n              Clear filters\r\n            </button>\r\n          </div>\r\n\r\n          {/* Grid */}\r\n          {loading ? (\r\n            <div className=\"grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4\">\r\n              {Array.from({ length: 8 }).map((_, i) => (\r\n                <div\r\n                  key={i}\r\n                  className=\"bg-white rounded-xl shadow-[0_1px_2px_rgba(0,0,0,0.06),0_10px_20px_rgba(0,0,0,0.06)] ring-1 ring-black/5 p-4 animate-pulse\"\r\n                >\r\n                  <div className=\"h-40 bg-gray-200 rounded mb-4\" />\r\n                  <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\" />\r\n                  <div className=\"h-4 bg-gray-200 rounded w-1/3\" />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : filtered.length === 0 ? (\r\n            <div className=\"bg-white rounded-xl p-10 text-center text-gray-600 ring-1 ring-black/5\">\r\n              No products found.\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4\">\r\n              {filtered.map((product) => (\r\n                <div\r\n                  key={product._id}\r\n                  className=\"relative bg-white rounded-xl shadow-[0_1px_2px_rgba(0,0,0,0.06),0_10px_20px_rgba(0,0,0,0.06)] ring-1 ring-black/5 overflow-hidden\"\r\n                >\r\n                  {/* Favorite */}\r\n                  <button\r\n                    onClick={() => toggleFavorite(product._id)}\r\n                    title={\r\n                      isFavorite(product._id)\r\n                        ? \"Remove from favorites\"\r\n                        : \"Add to favorites\"\r\n                    }\r\n                    className=\"absolute top-3 right-3 rounded-full bg-white/90 p-1.5 shadow ring-1 ring-black/5\"\r\n                  >\r\n                    <Heart filled={isFavorite(product._id)} />\r\n                  </button>\r\n\r\n                  {/* Image */}\r\n                  <div className=\"p-3\">\r\n                    <img\r\n                      src={getProductImage(product.image)}\r\n                      alt={product.name}\r\n                      className=\"w-full h-44 object-contain bg-white rounded-lg\"\r\n                      onError={(e) => (e.currentTarget.src = \"/placeholder.jpg\")}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Body */}\r\n                  <div className=\"px-4 pb-4\">\r\n                    <div className=\"text-xs text-gray-500\">\r\n                      {(product.countInStock ?? 0) > 0 ? \"In stock\" : \"Out of stock\"}\r\n                    </div>\r\n                    <h3 className=\"font-semibold mt-1 line-clamp-1\">{product.name}</h3>\r\n                    <p className=\"text-sm text-gray-600 line-clamp-2\">\r\n                      {product.description}\r\n                    </p>\r\n\r\n                    {/* Actions — Option A */}\r\n                    <div className=\"mt-3\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-lg font-bold\">\r\n                          ${Number(product.price || 0).toFixed(2)}\r\n                        </span>\r\n\r\n                        {token && (\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {/* Edit (icon) */}\r\n                            <button\r\n                              onClick={() => navigate(`/edit-product/${product._id}`)}\r\n                              title=\"Edit\"\r\n                              className=\"p-2 rounded-md bg-yellow-500/90 hover:bg-yellow-600 text-white ring-1 ring-black/5\"\r\n                            >\r\n                              <svg viewBox=\"0 0 24 24\" className=\"h-4 w-4\" fill=\"currentColor\">\r\n                                <path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\"/>\r\n                              </svg>\r\n                            </button>\r\n                            {/* Delete (icon) */}\r\n                            <button\r\n                              onClick={() => handleDelete(product._id)}\r\n                              title=\"Delete\"\r\n                              className=\"p-2 rounded-md bg-red-500/90 hover:bg-red-600 text-white ring-1 ring-black/5\"\r\n                            >\r\n                              <svg viewBox=\"0 0 24 24\" className=\"h-4 w-4\" fill=\"currentColor\">\r\n                                <path d=\"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"/>\r\n                              </svg>\r\n                            </button>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      <button\r\n                        onClick={() => addToCart(product)}\r\n                        className=\"mt-3 w-full px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold\"\r\n                      >\r\n                        Add to cart\r\n                      </button>\r\n                    </div>\r\n                    {/* /Actions */}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n};\r\n\r\nexport default Products;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}